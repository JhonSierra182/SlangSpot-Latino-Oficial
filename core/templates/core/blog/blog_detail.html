{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ post.title }} - Blog SlangSpot{% endblock %}

{% block extra_css %}
<style>
    .hero-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 60px 0;
        color: white;
    }
    
    .hero-content {
        text-align: center;
    }
    
    .breadcrumb {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 24px;
        font-size: 0.9rem;
        justify-content: center;
    }
    
    .breadcrumb a {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: color 0.3s ease;
    }
    
    .breadcrumb a:hover {
        color: white;
    }
    
    .breadcrumb-separator {
        color: rgba(255, 255, 255, 0.6);
    }
    
    .category-badge {
        display: inline-block;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .category-badge.slang { background: linear-gradient(45deg, #ff6b6b, #ee5a24); }
    .category-badge.culture { background: linear-gradient(45deg, #4834d4, #686de0); }
    .category-badge.tips { background: linear-gradient(45deg, #00b894, #00cec9); }
    .category-badge.stories { background: linear-gradient(45deg, #fdcb6e, #e17055); }
    .category-badge.interviews { background: linear-gradient(45deg, #6c5ce7, #a29bfe); }
    
    .post-title {
        font-size: 2.5rem;
        font-weight: 700;
        line-height: 1.2;
        margin-bottom: 20px;
    }
    
    .post-meta {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        font-size: 0.9rem;
        opacity: 0.9;
        flex-wrap: wrap;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .author-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.8rem;
    }
    
    .content-section {
        padding: 40px 0;
        background: #f8fafc;
    }
    
    .content-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        margin-top: -30px;
        position: relative;
        z-index: 10;
    }
    
    .featured-image {
        width: 100%;
        height: 250px;
        background: #e2e8f0;
        position: relative;
        overflow: hidden;
    }
    
    .featured-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .post-content {
        padding: 40px;
    }
    
    .content-text {
        font-size: 1.1rem;
        line-height: 1.7;
        color: #2d3748;
        margin-bottom: 30px;
    }
    
    .content-text h2 {
        font-size: 1.6rem;
        font-weight: 600;
        color: #1a202c;
        margin: 24px 0 12px 0;
    }
    
    .content-text h3 {
        font-size: 1.3rem;
        font-weight: 600;
        color: #2d3748;
        margin: 20px 0 10px 0;
    }
    
    .content-text p {
        margin-bottom: 16px;
    }
    
    .content-text ul, .content-text ol {
        margin: 16px 0;
        padding-left: 20px;
    }
    
    .content-text li {
        margin-bottom: 6px;
    }
    
    .content-text blockquote {
        border-left: 3px solid #667eea;
        padding-left: 16px;
        margin: 20px 0;
        font-style: italic;
        color: #4a5568;
        background: #f7fafc;
        padding: 12px 16px;
        border-radius: 0 6px 6px 0;
    }
    
    .actions-section {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 40px;
        background: #f7fafc;
        border-top: 1px solid #e2e8f0;
        flex-wrap: wrap;
        gap: 16px;
    }
    
    .like-section {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .like-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: 20px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
        font-size: 0.9rem;
    }
    
    .like-btn:hover {
        background: #5a67d8;
        transform: translateY(-1px);
        color: white;
        text-decoration: none;
    }
    
    .like-btn.liked {
        background: #e53e3e;
    }
    
    .like-count {
        font-size: 0.9rem;
        color: #4a5568;
        font-weight: 500;
    }
    
    .share-section {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .share-btn {
        background: #f7fafc;
        color: #4a5568;
        border: 1px solid #e2e8f0;
        padding: 8px 14px;
        border-radius: 16px;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.85rem;
    }
    
    .share-btn:hover {
        background: #edf2f7;
        border-color: #cbd5e0;
        color: #4a5568;
        text-decoration: none;
    }
    
    .related-section {
        padding: 40px 0;
        background: white;
    }
    
    .section-title {
        font-size: 1.8rem;
        font-weight: 600;
        text-align: center;
        margin-bottom: 30px;
        color: #1a202c;
    }
    
    .related-posts {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        max-width: 900px;
        margin: 0 auto;
    }
    
    .related-post {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        text-decoration: none;
        color: inherit;
    }
    
    .related-post:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        color: inherit;
        text-decoration: none;
    }
    
    .related-image {
        height: 140px;
        background: #e2e8f0;
        position: relative;
        overflow: hidden;
    }
    
    .related-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .related-post:hover .related-image img {
        transform: scale(1.03);
    }
    
    .related-content {
        padding: 16px;
    }
    
    .related-title {
        font-size: 1rem;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 6px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .related-meta {
        font-size: 0.8rem;
        color: #718096;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .back-btn {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: #667eea;
        color: white;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        transition: all 0.3s ease;
        z-index: 100;
    }
    
    .back-btn:hover {
        background: #5a67d8;
        transform: translateY(-2px);
        color: white;
        text-decoration: none;
    }
    
    @media (max-width: 768px) {
        .post-title {
            font-size: 2rem;
        }
        
        .post-meta {
            flex-direction: column;
            gap: 10px;
        }
        
        .post-content {
            padding: 24px;
        }
        
        .actions-section {
            padding: 16px 24px;
            flex-direction: column;
            align-items: stretch;
        }
        
        .like-section, .share-section {
            justify-content: center;
        }
        
        .related-posts {
            grid-template-columns: 1fr;
            gap: 16px;
        }
        
        .back-btn {
            bottom: 16px;
            left: 16px;
            width: 44px;
            height: 44px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- CSRF Token for JavaScript -->
{% csrf_token %}

<!-- Hero Section -->
<section class="hero-section">
    <div class="container mx-auto px-4">
        <div class="hero-content">
            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <a href="{% url 'core:home' %}">Inicio</a>
                <span class="breadcrumb-separator">/</span>
                <a href="{% url 'core:blog_list' %}">Blog</a>
                <span class="breadcrumb-separator">/</span>
                <span style="color: rgba(255, 255, 255, 0.9);">{{ post.title|truncatechars:30 }}</span>
            </div>
            
            <!-- Category Badge -->
            <div class="category-badge {{ post.category }}">
                {{ post.get_category_display }}
            </div>
            
            <!-- Post Title -->
            <h1 class="post-title">{{ post.title }}</h1>
            
            <!-- Post Meta -->
            <div class="post-meta">
                <div class="meta-item">
                    <div class="author-avatar">
                        {{ post.author.username|first|upper }}
                    </div>
                    <span>{{ post.author.username }}</span>
                </div>
                <div class="meta-item">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    {{ post.created_at|date:"d M Y" }}
                </div>
                <div class="meta-item">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    {{ post.views }} vistas
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Content Section -->
<section class="content-section">
    <div class="container mx-auto px-4">
        <div class="content-container">
            <!-- Featured Image -->
            {% if post.featured_image %}
            <div class="featured-image">
                <img src="{{ post.featured_image.url }}" alt="{{ post.title }}">
            </div>
            {% endif %}
            
            <!-- Post Content -->
            <div class="post-content">
                {% if post.excerpt %}
                <div class="content-text" style="font-style: italic; color: #4a5568; background: #f7fafc; padding: 16px; border-radius: 8px; margin-bottom: 24px; border-left: 3px solid #667eea;">
                    <strong>Resumen:</strong> {{ post.excerpt }}
                </div>
                {% endif %}
                
                <div class="content-text">
                    {{ post.content|linebreaks }}
                </div>
            </div>
            
            <!-- Actions Section -->
            <div class="actions-section">
                <div class="like-section">
                    <button type="button" class="like-btn {% if user in post.likes.all %}liked{% endif %}" onclick="toggleLike('{{ post.slug }}')" id="like-btn-{{ post.slug }}">
                        <svg class="w-4 h-4" fill="{% if user in post.likes.all %}currentColor{% else %}none{% endif %}" stroke="currentColor" viewBox="0 0 24 24" id="like-icon-{{ post.slug }}">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                        Me gusta
                    </button>
                    <span class="like-count" id="like-count-{{ post.slug }}">{{ post.likes.count }} me gusta</span>
                </div>
                
                <div class="share-section">
                    <button type="button" class="share-btn" onclick="copyToClipboard()" id="share-btn">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>
                        </svg>
                        Compartir
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related Posts Section -->
{% if related_posts %}
<section class="related-section">
    <div class="container mx-auto px-4">
        <h2 class="section-title">Artículos Relacionados</h2>
        <div class="related-posts">
            {% for related_post in related_posts %}
            <a href="{{ related_post.get_absolute_url }}" class="related-post">
                <div class="related-image">
                    <img src="{{ related_post.get_featured_image_url }}" alt="{{ related_post.title }}">
                </div>
                <div class="related-content">
                    <h3 class="related-title">{{ related_post.title }}</h3>
                    <div class="related-meta">
                        <span>{{ related_post.created_at|date:"d M Y" }}</span>
                        <span>•</span>
                        <span>{{ related_post.get_category_display }}</span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Back Button -->
<a href="{% url 'core:blog_list' %}" class="back-btn">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
    </svg>
</a>

<script>
function toggleLike(slug) {
    const likeBtn = document.getElementById(`like-btn-${slug}`);
    const likeIcon = document.getElementById(`like-icon-${slug}`);
    const likeCount = document.getElementById(`like-count-${slug}`);
    
    // Deshabilitar el botón temporalmente para evitar múltiples clics
    likeBtn.disabled = true;
    
    // Obtener el token CSRF
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                     document.cookie.split('; ').find(row => row.startsWith('csrftoken='))?.split('=')[1];
    
    fetch(`/core/blog/${slug}/like/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken,
        },
    })
    .then(response => response.json())
    .then(data => {
        // Actualizar el estado del botón
        if (data.liked) {
            likeBtn.classList.add('liked');
            likeIcon.setAttribute('fill', 'currentColor');
        } else {
            likeBtn.classList.remove('liked');
            likeIcon.setAttribute('fill', 'none');
        }
        
        // Actualizar el contador
        likeCount.textContent = `${data.likes_count} me gusta`;
        
        // Efecto visual de confirmación
        likeBtn.style.transform = 'scale(1.1)';
        setTimeout(() => {
            likeBtn.style.transform = 'scale(1)';
        }, 150);
    })
    .catch(error => {
        console.error('Error:', error);
        // Mostrar mensaje de error si es necesario
    })
    .finally(() => {
        // Habilitar el botón nuevamente
        likeBtn.disabled = false;
    });
}

function copyToClipboard() {
    const shareBtn = document.getElementById('share-btn');
    const currentUrl = window.location.href;
    
    // Deshabilitar el botón temporalmente
    shareBtn.disabled = true;
    
    // Intentar copiar al portapapeles usando la API moderna
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(currentUrl).then(() => {
            showShareNotification(shareBtn, '¡Enlace copiado!');
        }).catch(() => {
            // Fallback para navegadores que no soportan la API
            fallbackCopyTextToClipboard(currentUrl, shareBtn);
        });
    } else {
        // Fallback para navegadores más antiguos
        fallbackCopyTextToClipboard(currentUrl, shareBtn);
    }
}

function fallbackCopyTextToClipboard(text, shareBtn) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    textArea.style.top = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showShareNotification(shareBtn, '¡Enlace copiado!');
        } else {
            showShareNotification(shareBtn, 'Error al copiar', 'error');
        }
    } catch (err) {
        showShareNotification(shareBtn, 'Error al copiar', 'error');
    }
    
    document.body.removeChild(textArea);
}

function showShareNotification(shareBtn, message, type = 'success') {
    // Crear notificación
    const notification = document.createElement('div');
    notification.className = `share-notification ${type}`;
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#10b981' : '#ef4444'};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateX(100%);
        transition: transform 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    // Animar entrada
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 10);
    
    // Efecto visual en el botón
    shareBtn.style.transform = 'scale(1.1)';
    setTimeout(() => {
        shareBtn.style.transform = 'scale(1)';
    }, 150);
    
    // Remover notificación después de 3 segundos
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
    
    // Habilitar el botón nuevamente
    shareBtn.disabled = false;
}
</script>
{% endblock %} 